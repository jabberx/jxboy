<html>
<head>
<meta charset='utf-8'>
<style>
body {
  font-family: monospace;
  background: #333;
  color: #eee;
}
</style>
</head>
<body>
<h1>JXBoy - браузерный эмулятор игровой консоли</h1>

<a href="asm.html">JXBoy ассемблер онлайн</a><br/>
<a href="debug.html">JXBoy - проигрыватель/отладчик</a><br/>

<pre>
Характеристики: процессор 8-битный, скорость ограничена 32КГц (примерное значение),
4096 байта памяти, 1024 отведено под стек, 2048 под стек вызовов (адресация кода - 2-байтная),
первые 1024 байта - доступная память: байт клавиатуры, 32 байта дисплея, свободная память
Дисплей монохромный 16 на 16 пикселей. Клавиатура 8 кнопок.
Ассемблер 53 команды.
Особенность: отсутствие регистров и операндов (исключения - метки).
Машинный код состоит из печатных символов и может переноситься копированием-вставкой текста.
В связи с ограничением адресации максимальный размер программы - 64Кб.

Клавиатура
Первый байт оперативной памяти - битовая маска клавиатуры.
Биты (от младшего) показывают состояние клавиш: влево, вправо, вверх, вниз, пробел, левый shift, x, c.
Бит будет установлен ровно столько сколько нажата соответствующая клавиша.

Дисплей
После байта клавиатуры идут 32 байта дисплея. Первые 2 байта составляют первый ряд из 16 пикселей,
следующие 2 байта второй ряд и так далее.
Имеется два режима обновления дисплея: немедленный и отложенный (по команде).
Режим переключается командой MODE.
Обновление экрана в отложенном режиме происходит по команде UPD.
По умолчанию включен немедлленный режим.

Память и каретка
Имеется одна каретка, которая указывает на ячейку оперативной памяти. 
На старте программы это самая первая ячейка (байт состояния клавиатуры).
Команды LEFT и RIGHT позволяют двигать каретку в пределах 1024 байт доступной памяти.
LEFT на первом байте перенесет каретку в конец, RIGHT на последнем - в начало.
Команда STEPI увеличивает шаг команд LEFT и RIGHT вдвое.
Команда STEPD уменьшает вдвое этот шаг.
STEPR сбрасывает шаг до 1.
LOAD 0..255/0x00..0xFF/0b00000000..0b11111111 - запись значения в текущую ячейку, 
примеры: LOAD 16  LOAD 0xf  LOAD 0xEC  LOAD 0b1100
COPYL копирование байта текущей ячейки в левую ячейку
COPYR копирование байта текущей ячейки в правую ячейку
SWAPL обмен с левой ячейкой
SWAPR обмен с правой ячейкой
Команда DPUSH помещает в стек адрес каретки. Этот адрес состоит из 2 байт: 
первым в стек идет младший байт, следующим - старший.
Команда ASET перемещает каретку в адрес (из 2 байт - см. выше) из стека, стек при этом не освобождается.
Особый режим работы каретки - когда адрес запоминается и каретка сдвигается на другой адрес.
В особом режиме каретка может передвигаться как угодно, а при возвращении в обычный режим
она ставится на запомненный ранее адрес.
В особый режим можно перейти следующими командами:
ASETK - переход в особый режим и установка каретки в нулевую позицию (байт клавиатуры)
ASETA, ASETB, ASETC, ASETJ - действие схоже с ASETK, отличаются только адреса, 
адреса этих 4 ячеек расположены после байтов дисплея, кроме того между ними есть зазор в один байт.
ASETN - ссылается на байт негативного флага. После операций SUB/DEC этот байт содержит единицу если
результат операции привел к отрицательному значению.
ASETO - ссылается на байт переполнения. После операций ADD/SHL/INC этот байт содержит единицу если
произошло переполнение (результат больше 255) или 0, а также старший байт после операции MUL.
ASETG - байт дробного значения. После операции деления содержит дробную часть умноженную на 100.
Возврат в обычный режим осуществляется командой ASETM, при этом каретка устанавливается
запомненный при выходе из обычного режима адрес.
Отдельная команда - ASETF - не дает перехода в особый режим. Это безвозвратная установка
каретки на первый "свободный" байт (после байтов дисплея и всех ячеек доступных по командам ASET*).

Стек
Работает как и другой стек - как стопка тарелок.
PUSH помещает в стек значение ячейки на которую указывает каретка
POP достает из стека байт и помещает в ячейку под кареткой
DUP дублирует верхний байт на стеке
DROP удаление верхнего байта со стека
SWAP обмен двух верхних значений стека
SCLR очистка стека (установка указателя стека в 0)
SREV разворот стека - последнее значение ставится на первое место, 
предпоследнее - на второе и так далее, в итоге самое старое значение оказывается на верху

Арифметика
ADD, SUB, MUL, DIV - сложение, вычитание, умножение, деление -
все эти команды кроме четырех последних работают с текущей и следующей (справа) ячейкой.
ADD - к значению текущей прибавляет значение следующей
SUB - из значения текущей вычитает значение следующей
MUL - значение текущей умножает на значение следующей
DIV - значение текущей делит на значение следующей
INC - увеличить на единицу
DEC - уменьшить на единицу
SHL - битовый сдвиг влево (умножение на 2)
SHR - битовый сдвиг вправо (деление на 2)

Логические операторы
Так же работа с текущей ячейкой (куда помещается результат) и ячейкой справа 
(кроме NOT, где все происходит в одной ячейке): 
OR, AND, NOT, XOR.

Переходы
метка:
label1:
Две предыдущие строчки содержат примеры меток - строчки с двоеточием в конце.
JZ метка - переход на метку если в ячейке под кареткой ноль
JNZ метка - переход если не ноль
JUMP метка - переход в любом случае
Эти три перехода короткие. Это значит что их дальность не больше +/-127 байт машинного кода. 
(надо знать, что каждая команда в машинном коде не всегда = 1 байт, например команда LOAD содержит 2 байта,
а команды перехода от 7 до 10 байт).
При необходимости их можно комбинировать с длинным прыжком:
FJUMP метка - этот прыжок позволит перенестись на любую метку в программе от нулевого до 65535-го байта.
Во время переходов идет работа со стеком и текущей ячейкой.
Поэтому если осуществлять переход в то время как каретка находится на экранном байте
в немедленном режиме обновления экрана то на экране будут заметны артефакты.
В таком случае следует в начале программы включить отложенный режим и пользоваться командой 
обновления до переходов.

Вызов подпрограмм
CALL метка - короткий вызов (действует то же правило что и для коротких переходов)
FCALL метка - длинный вызов
RET - возврат из подпрограммы

Дополнительные команды
NOP пропуск - ничего не делать
HALT остановка выполнения программы
Команда PPUSH помещает в стек адрес текущей команды (адрес из 2 байт: наверху стека будет старший).

Комментарии
Всё в строчке после точки с запятой ; игнорируется как комментарий
</pre>
</body>
